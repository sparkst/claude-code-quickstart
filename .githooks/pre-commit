#!/usr/bin/env bash
# REQ-110 â€” Pre-commit validation hook
# This hook runs before each commit to ensure code quality

set -e

echo "ğŸ” Running pre-commit validations..."

# Format check
echo "ğŸ“ Checking code formatting..."
if ! npm run format:check >/dev/null 2>&1; then
  echo "âŒ Code formatting issues found. Run 'npm run format' to fix."
  exit 1
fi
echo "âœ… Code formatting validated"

# Linting
echo "ğŸ” Running linting..."
if ! npm run lint >/dev/null 2>&1; then
  echo "âŒ Linting issues found. Fix issues before committing."
  exit 1
fi
echo "âœ… Linting validated"

# Quick tests (subset for speed)
echo "ğŸ§ª Running quick tests..."
if ! npm run test:run >/dev/null 2>&1; then
  echo "âš ï¸ Some tests failed - consider running full test suite"
  # Don't fail commit for test failures, but warn
fi
echo "âœ… Quick tests completed"

# Basic secret scanning
echo "ğŸ” Scanning for potential secrets..."
if git diff --cached | grep -iE "(password|secret|key|token)" | grep -v "test\|spec\|mock"; then
  echo "âš ï¸ Potential secrets detected in staged changes"
  echo "ğŸ’¡ Please review and ensure no actual secrets are being committed"
  # Don't fail commit but warn
fi

echo "âœ… Pre-commit validation completed successfully"